document.addEventListener("DOMContentLoaded", function () {
    console.log("Widget Initialized");

    // Subscribe to "ready" event to retrieve data dynamically
    JFCustomWidget.subscribe("ready", function (data) {
        console.log("Widget Ready - Fetching Parent Form Data");

        // Automatically adjust iframe size
        JFCustomWidget.requestFrameResize({ width: 400, height: 250 });

        // Get "Is this your first tattoo?" response dynamically
        let firstTattooResponse = JFCustomWidget.getWidgetSetting("first_tattoo_question");
        console.log("First Tattoo Question Response:", firstTattooResponse);

        // Display the response inside the widget's short text field
        document.getElementById("userTattooResponse").value = firstTattooResponse || "Not answered";

        // Disable "Torso" option if "Yes" is selected
        if (firstTattooResponse === "Yes") {
            document.getElementById("torsoOption").disabled = true;
            document.getElementById("torsoLabel").classList.add("disabled");
        }
    });

    // Capture user selection and send it back to JotForm
    document.querySelectorAll("input[name='tattooPlacement']").forEach(radio => {
        radio.addEventListener("change", function () {
            let selectedPlacement = document.querySelector("input[name='tattooPlacement']:checked").value;
            console.log("User selected:", selectedPlacement);

            // Send the selected placement back to JotForm
            let result = {
                valid: true,
                value: selectedPlacement
            };
            JFCustomWidget.sendSubmit(result);
        });
    });
});
